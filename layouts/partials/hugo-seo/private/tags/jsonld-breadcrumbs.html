{{- /* https://developers.google.com/search/docs/advanced/structured-data/breadcrumb#json-ld_1 */ -}}
{{ $s := newScratch }}
{{ $s.Set "breadcrumb" dict }}
{{ $s.Set "itemCount" 1 }}

{{ partial "inline/breadcrumb-recursive" (dict "scratch" $s "parent" .parent) }}

{{ $s.Add  "itemList" (slice (dict 
  "@type" "ListItem"
  "name" .title
  "position" ($s.Get "itemCount")
)) }}

{{ $s.SetInMap "breadcrumb" "@context" "https://schema.org" }}
{{ $s.SetInMap "breadcrumb" "@type" "BreadcrumbList" }}
{{ $s.SetInMap "breadcrumb" "itemListElement" ($s.Get "itemList") }}

{{ return $s.Get "breadcrumb" }}

{{/* .Permalink, .Title, .Parent are from the "parent" context (generated by Hugo, not the params partial) */}}
{{ define "partials/inline/breadcrumb-recursive" }}
  {{ $scratch := .scratch }}
  {{ with .parent }}
    {{ partial "inline/breadcrumb-recursive" (dict "scratch" $scratch "parent" .Parent) }}
    {{ $title := .Params.seo.title | default .Title }}
    {{- $scratch.Add  "itemList" (slice (dict 
      "@type" "ListItem"
      "item" .Permalink 
      "name" $title
      "position" ($scratch.Get "itemCount")
    )) -}}
    {{ $scratch.Add "itemCount" 1 }}
  {{ end }}
{{ end }}
